import Arduino_Board_Discovery from '../images/device/Arduino_Board_Discovery.png' 
import Arduino_Board_PartNumber from '../images/device/Arduino_Board_PartNumber.png' 
import Arduino_Compile from '../images/device/Arduino_Compile.png' 
import LongFi_Example from '../images/device/LongFi_Example.png' 
import LongFi_Library from '../images/device/LongFi_library.png' 
import upload_sketch from '../images/device/upload_sketch.png' 
import upload_success from '../images/device/Arduino_Upload_Successful.png'
import request_bin from '../images/console/request_bin.png' 
import pasted_endpoint from '../images/console/pasted_endpoint.png' 
import set_channel_as_default from '../images/console/set_channel_as_default.gif' 
import device_packets from '../images/console/no_channel_packets.png'
import disco_board from '../images/device/disco_board.png'
import console_device_details from '../images/console/console_device_details.png'
import MCCI_Library from '../images/device/library_manager.png'


# LongFi Arduino Quickstart Guide
 


## Introduction

#### Helium’s LongFi architecture combines LoRaWAN and the Helium blockchain to create a wireless peer-to-peer network for low-bandwidth IoT applications.

This guide will show you step by step how to transmit LoRaWAN packets using a longfi-arduino sketch on an STMicroelectronics B-L072Z-LRWAN1 Discovery kit.

> ##### Important!  
>Before we begin, please make sure you've followed the steps from this [guide](/quickstart), which goes over some initial setup steps. 


## Objective 

In this guide, you will learn:

* How to setup your environment (Add STM32 board support to Arduino and STLink debugging utility)
* How to build and program a basic application that will send packets on the Helium Network
* Verify real time packets sent to a Helium Hotspot on Console. 
 
For this example, you’ll need the following:

### Hardware
 
* <a href="https://www.st.com/en/evaluation-tools/b-l072z-lrwan1.html" target="_blank">STMicroelectronics B-L072Z-LRWAN1 Discovery kit</a>
* Micro USB Type B Cable - <a href="https://www.amazon.com/AmazonBasics-Male-Micro-Cable-Black/dp/B0719H12WD/ref=sr_1_2_sspa?" target="_blank">Example </a>

### Software

* <a href="https://www.arduino.cc/en/Main/Software" target="_blank">Arduino software (IDE)</a> 
* <a href="https://github.com/stm32duino/Arduino_Core_STM32#getting-started" target="_blank">STM32 Board Support</a> 
* <a href="https://www.st.com/en/development-tools/stm32cubeprog.html" target="_blank">STLink Debugging Utility</a> 
* <a href="https://console.helium.com/" target="_blank">Helium Console</a> 

## Hardware setup

The build for this project is easy! You’ll just need to install the included antenna.  
 
We'll be using the ST-Link debugger on the Discovery board, so you'll want to connect the micro-USB B connector to the micro-USB port labeled `CN7 USB STLINK`.
 
<img src={disco_board} /> 

That’s it for the hardware setup! Next we will setup your environment. We will be using the Arduino IDE. 

## Getting the Arduino IDE
 
Download and install the latest version of <a href="https://www.arduino.cc/en/Main/Software" target="_blank">Arduino IDE </a> for your preferred OS. 
 
* <a href="https://www.arduino.cc/en/Guide/Windows" target="_blank">Windows </a>
* <a href="https://www.arduino.cc/en/Guide/linux" target="_blank">Linux </a>
* <a href="https://www.arduino.cc/en/Guide/MacOSX" target="_blank">Mac OSX</a>

## Add STM32 board support to Arduino
 
<a href="https://github.com/stm32duino/wiki/wiki/Getting-Started" target="_blank">Instructions to add STM32 board support to Arduino</a> 

## Install MCCI LoRaWAN LMIC Library
 
The MCCI LoRaWAN LMIC Library library may be installed from the Arduino IDE 

Arduino IDE:

```
Sketch -> Include Libraries -> Manage Libraries 
```

Search for `MCCI LMIC` and install the latest version of `MCCI LoRaWAN LMIC Library` 

<img src={MCCI_Library} /> 

> ##### Important! 
> If you have already installed the MCCI LMIC library, please make sure to check for updates



## LongFi Example Sketches 

There is <a href="https://github.com/helium/longfi-arduino/blob/master/longfi-us915/longfi-us915.ino" target="_blank">an example sketch</a> included in the LongFi repository.

Create a new sketch and copy the source code over. All you need to do is update the AppEui, DevEui, and AppKey. AppEui (LSB) and AppKey (MSB) are provided from Helium Console after you've created your device:

 <img src={console_device_details} />  

Be sure to select the appropriate format (LSB/Little-Endian for AppEui and MSB/Big-Endian for AppKey) and copy the information into the sketch:

```
static const u1_t PROGMEM APPEUI[8]= { 0x0B, 0x10, 0xDF, 0x45, 0xFC, 0xAD, 0xEC, 0x0F };
void os_getArtEui (u1_t* buf) { memcpy_P(buf, APPEUI, 8);}

static const u1_t PROGMEM APPKEY[16] = { 0x29, 0xFE, 0xF6, 0x75, 0x97, 0x18, 0xE3, 0x25, 0x72, 0x64, 0xBA, 0x25, 0x82, 0x8C, 0x94, 0xFA };
void os_getDevKey (u1_t* buf) {  memcpy_P(buf, APPKEY, 16);}
```

Note that you can put arbitrary data into DevEui; you can use this later in your applications to identify certain settings:

```
static const u1_t PROGMEM DEVEUI[8]= { 0x6B, 0x8B, 0xEF, 0xC7, 0x43, 0x89, 0xFB, 0x38 };
void os_getDevEui (u1_t* buf) { memcpy_P(buf, DEVEUI, 8);}
```

 ## Configuring the Arduino IDE for the B-L072Z-LRWAN1 - ST STM32L0 Discovery kit
 
Instructions to install the board support package can be found <a href="https://github.com/stm32duino/Arduino_Core_STM32#getting-started" target="_blank">here</a> 


Arduino IDE:
 
```
Select Tools -> Board -> Discovery
```
 
<img src={Arduino_Board_Discovery} /> 
 

```
Select Tools -> Board part number -> Discovery L072Z-LRWAN1
```

<img src={Arduino_Board_PartNumber} /> 

## Programming (Upload Method)

We will use the onboard ST-Link (Flasher/Debugger) to upload this sketch. 
 
Download and install the required utility from ST <a href="https://www.st.com/en/development-tools/stm32cubeprog.html" target="_blank">here</a> 

The download comes in the form of a `stm32cubeprog.zip` file, which you'll need to unpack. After you unzip, you should see the following files:

```
SetupSTM32CubeProgrammer-[version].exe
SetupSTM32CubeProgrammer-[version].linux
SetupSTM32CubeProgrammer-[version].app
```

### Installation Requirements

**Supported operating systems and architectures**
* Linux 64-bit 
* Windows 7/8/10 32-bit and 64-bit 
* MacOS (minimum version OS X Yosemite)

**Software Requirements**
* <a href="https://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html" target="_blank">Java SE Run Time Environment 1.8</a> or newer must be installed (from Oracle)


### Windows Instructions

The download comes with a `SetupSTM32CubeProgrammer-[version].exe`, which guides you through the installation process. 

### Linux Instructions

The download comes with a `SetupSTM32CubeProgrammer-[version].linux`, which guides you through the installation process. 

### MacOS Instructions

Run the following command: 

`java -jar SetupSTM32CubeProgrammer-[version].exe`

**You should use the default installation path.** 
## 

Arduino IDE:

```
Select Tools -> Upload Method -> STM32CubeProgrammer(SWD)
```

<img src={upload_sketch} /> 

## Programming your Arduino Sketch

Arduino IDE:

```
Select Sketch -> Verify/Compile (Ctrl + R)
```
 
 <img src={Arduino_Compile} /> 
 
If there are no errors with your sketch, you should see `Done Compiling`.

Then, you can upload the sketch and program the development board. 
 
Arduino IDE:

```
Select Sketch -> Upload (Ctrl + U)
```
 
<img src={upload_success} />
 
Congratulations! You have just programmed your first Helium LongFi application! 

However, we are not done just yet. Now let's head back to [Helium Console](https://console.helium.com) and look at our device. 

You should be able to see some packets appear as Live Data. 

<img src={device_packets} />

To learn about routing these packets to an endpoint, check out this [guide] (/console/routing-data). 

If you've loaded the ButtonTransmit sketch, you can learn about decoding these packets and triggering a service on IFTTT by checking out this [guide] (/console/trigger-ifttt).









